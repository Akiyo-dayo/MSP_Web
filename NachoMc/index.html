<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NachoNeko Server</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="logo">
            <a href="#home">
                <img src="image/logo.png" alt="NachoNeko的小窝">
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="rules.html" aria-label="游玩须知"><i class="fas fa-book"></i></a></li>
                <li><a href="changelog.html" aria-label="更新日志"><i class="fas fa-history"></i></a></li>
                <li><a href="members.html" aria-label="成员列表"><i class="fas fa-users"></i></a></li>
                <li><a href="donate.html" aria-label="赞赏支持"><i class="fas fa-heart"></i></a></li>
                <li>
                    <button class="theme-toggle" aria-label="切换主题">
                        <i class="fas fa-moon"></i>
                    </button>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero">
            <div class="hero-content">
                <h1>NachoNeko Minecraft <img src="image/label.png" alt="label" class="title-icon"></h1>
            </div>
            <div class="hero-image">
                <img src="image/mian.png" alt="NachoNeko 服务器展示">
            </div>
        </section>

        <section class="servers-grid">
            <!-- 服务器状态卡片将在这里动态生成 -->
        </section>
    </main>

    <aside class="sidebar">
        <div class="search-box">
            <input type="text" placeholder="想找什么喵？">
        </div>
    </aside>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>快速链接</h3>
                <ul>
                    <li><a href="#home" aria-label="主页"><i class="fas fa-home"></i></a></li>
                    <li><a href="rules.html" aria-label="游玩须知"><i class="fas fa-book"></i></a></li>
                    <li><a href="changelog.html" aria-label="更新日志"><i class="fas fa-history"></i></a></li>
                    <li><a href="members.html" aria-label="成员列表"><i class="fas fa-users"></i></a></li>
                    <li><a href="donate.html" aria-label="赞赏支持"><i class="fas fa-heart"></i></a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>© 2025 F1y/Car. 保留所有权利。</p>
        </div>
    </footer>
    <script src="theme.js"></script>
    <script>
        // 服务器ID映射
        const serverIdMap = {
            // "香草纪元整合包": "server-vefc",  // 已删除
            "1.21.4FB原版": "server-fb214",
            "1.21生电服": "server-fb21",
            "1.20.1 机械动力-月亮工厂": "create",
            "1.20.1空岛": "sky-land"
        };

        /**
         * 解析服务器状态文本
         */
        function parseServerStatus(text) {
            const lines = text.split('\n').filter(line => line.trim());
            let currentServer = null;
            const servers = [];
            let checkTime = '';

            lines.forEach(line => {
                line = line.trim();
                
                if (line.startsWith('检查时间:')) {
                    checkTime = line.split(': ')[1];
                }
                else if (line.endsWith(':')) {
                    // 新的服务器块开始
                    currentServer = {
                        name: line.split(' (')[0],
                        address: line.slice(line.indexOf('(') + 1, -2),
                        version: '',
                        players: [],
                        online: 0,
                        max_players: 0,
                        status: 'offline',
                        timestamp: checkTime
                    };
                    servers.push(currentServer);
                }
                else if (currentServer) {
                    if (line.startsWith('服务器版本:')) {
                        currentServer.version = line.split(': ')[1];
                        currentServer.status = 'online';
                    }
                    else if (line.startsWith('在线玩家:')) {
                        const playerList = line.split(': ')[1];
                        currentServer.players = playerList === '当前没有在线玩家' ? [] : playerList.split(', ');
                    }
                    else if (line.startsWith('玩家数:')) {
                        const [current, max] = line.split(': ')[1].split('/');
                        currentServer.online = parseInt(current);
                        currentServer.max_players = parseInt(max);
                    }
                }
            });

            return servers;
        }

        /**
         * 更新服务器状态显示
         */
        function updateServerStatus() {
            fetch('server_status.txt', {
                cache: 'no-store'  // 禁用缓存
            })
            .then(response => response.text())
            .then(text => {
                const servers = parseServerStatus(text);
                const serversGrid = document.querySelector('.servers-grid');
                
                if (serversGrid) {
                    serversGrid.innerHTML = ''; // 清空现有内容

                    servers.forEach(server => {
                        const serverCard = document.createElement('div');
                        serverCard.className = `server-card ${server.status}`;
                        serverCard.style.cursor = 'pointer';
                        
                        // 添加点击事件
                        serverCard.onclick = () => {
                            const serverId = serverIdMap[server.name];
                            if (serverId) {
                                window.location.href = `changelog.html#${serverId}`;
                            }
                        };

                        const statusIcon = server.status === 'online' ? 
                            '<i class="fas fa-check-circle"></i>' : 
                            '<i class="fas fa-times-circle"></i>';

                        let playersHtml = '';
                        if (server.status === 'online') {
                            if (server.players && server.players.length > 0) {
                                playersHtml = `
                                    <div class="players-list">
                                        <h4>在线玩家:</h4>
                                        <ul>
                                            ${server.players.map(player => `<li>${player}</li>`).join('')}
                                        </ul>
                                    </div>
                                `;
                            } else {
                                playersHtml = '<p>当前没有在线玩家</p>';
                            }
                        }

                        serverCard.innerHTML = `
                            <h3>${server.name} ${statusIcon}</h3>
                            <p class="server-address">${server.address}</p>
                            ${server.status === 'online' ? `
                                <p class="server-info">版本: ${server.version}</p>
                                <p class="player-count">玩家: ${server.online}/${server.max_players}</p>
                                ${playersHtml}
                            ` : `
                                <p class="error-message">服务器离线</p>
                            `}
                            <p class="update-time">更新时间: ${server.timestamp}</p>
                        `;
                        
                        serversGrid.appendChild(serverCard);
                    });
                }
            })
            .catch(error => {
                console.error('获取服务器状态失败:', error);
                const serversGrid = document.querySelector('.servers-grid');
                if (serversGrid) {
                    serversGrid.innerHTML = `
                        <div class="server-card offline">
                            <h3>错误 <i class="fas fa-times-circle"></i></h3>
                            <p class="error-message">无法获取服务器状态</p>
                        </div>
                    `;
                }
            });
        }

        // 页面加载时立即更新一次
        updateServerStatus();
        // 每30秒更新一次
        setInterval(updateServerStatus, 30000);
    </script>
</body>
</html> 