# 访问统计功能使用说明

## 功能说明
在"系统在线"标识上悬停鼠标，会显示：
- 总浏览数(PV)：网站从部署开始的总访问次数
- 今日访客(UV)：当天的独立访客数（基于IP地址统计）
- 总用户数：从部署开始累计的独立访客总数

## 快速开始

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动后端服务
```bash
python stats_server.py
```

服务将在 `http://localhost:5000` 启动

### 3. 打开网站
使用浏览器打开 `index.html` 文件，或者使用本地服务器：

使用 Python 启动简单的HTTP服务器：
```bash
# Python 3
python -m http.server 8000
```

然后访问 `http://localhost:8000`

## API接口说明

### 记录访问
- **URL**: `/api/visit`
- **方法**: POST
- **响应**: 
  ```json
  {
    "total_visits": 123,
    "today_visits": 5,
    "total_users": 45
  }
  ```
  说明：
  - `total_visits`: 总浏览数(PV)
  - `today_visits`: 今日独立访客数(UV)
  - `total_users`: 累计独立访客总数

### 获取统计数据
- **URL**: `/api/stats`
- **方法**: GET
- **响应**: 
  ```json
  {
    "total_visits": 123,
    "today_visits": 5,
    "total_users": 45
  }
  ```

### 健康检查
- **URL**: `/health`
- **方法**: GET
- **响应**: 
  ```json
  {
    "status": "online"
  }
  ```
  注意：此接口尚未在当前代码中实现

## 数据存储
访问统计数据保存在 `stats.json` 文件中，格式如下：
```json
{
  "total_visits": 123,
  "daily_visits": {
    "2025-12-15": 45,
    "2025-12-16": 30
  },
  "unique_visitors": {
    "2025-12-15": ["192.168.1.1", "192.168.1.2"],
    "2025-12-16": ["192.168.1.1"]
  },
  "total_unique_ips": ["192.168.1.1", "192.168.1.2"]
}
```
说明：
- `total_visits`: 总浏览数(PV - Page Views)
- `daily_visits`: 每日浏览数记录
- `unique_visitors`: 每日独立访客IP列表(UV - Unique Visitors)
- `total_unique_ips`: 累计所有独立访客IP列表

## 部署到生产环境

### 使用 Gunicorn (推荐用于生产环境)
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 stats_server:app
```

### 修改前端API地址
如果部署到服务器，需要修改 `script.js` 中的 `API_BASE_URL`：
```javascript
const API_BASE_URL = 'https://your-domain.com/api';
```

## 注意事项
1. 后端服务必须先启动，前端才能正常显示统计数据
2. 如果后端服务未启动，前端会显示 "---" 作为占位符
3. 统计数据每30秒自动刷新一次
4. 每次页面加载都会记录一次访问
5. 独立访客(UV)基于IP地址识别，同一IP同一天多次访问只计为1个访客
6. 总浏览数(PV)记录所有访问次数，不去重

## 移动端优化
提示框会自动适配移动端设备，在小屏幕上显示效果良好。

## 故障排除

### 前端显示 "加载中..." 或 "---"
- 检查后端服务是否启动
- 检查浏览器控制台是否有CORS错误
- 确认 `API_BASE_URL` 配置正确

### 统计数据不更新
- 检查 `stats.json` 文件权限
- 查看后端日志是否有错误
- 确认后端服务正常运行
- 检查服务器控制台输出的访问日志

## 扩展功能建议
1. 添加数据库支持（如 SQLite、MySQL）
2. 添加更详细的统计（如页面停留时间、来源分析）
3. 添加管理后台查看详细统计数据
4. 添加图表展示访问趋势
5. 实现 `/health` 健康检查接口
6. 添加访问日志记录功能
7. 支持按地理位置统计访客分布

## 技术实现细节

### 统计逻辑
- **PV (Page Views)**: 每次访问 `total_visits` 加1
- **UV (Unique Visitors)**: 每天每个IP只计数一次，存储在 `unique_visitors[today]` 列表中
- **总用户数**: 所有时间段的独立IP数，存储在 `total_unique_ips` 列表中
- **日期更新**: 自动根据系统日期判断，无需手动重置

### CORS配置
后端使用 `flask-cors` 实现跨域支持，允许前端从不同端口/域名访问API

### 数据持久化
使用JSON文件存储，每次访问立即保存，确保数据不丢失
